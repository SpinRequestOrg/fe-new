import{_ as I}from"./CEjNp6Up.js";import{_ as L}from"./DVx_XNg2.js";import{e as $,f as R,r as V,g as j,s as N,h as M,i as U,j as B,k as q,l as W,m as G,o as i,c as l,n as t,a,b as o,t as w,d as C,w as p,_ as E,F as H,L as S,p as T}from"./C9o7SX3v.js";import{u as J}from"./CorZQDxr.js";/**
 * @license lucide-vue-next v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=$("CircleCheckIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=$("TriangleAlertIcon",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),P=(u,r)=>{const{$repo:{auth:f}}=R(),x=V(null),v=V(null),d=V(!1),m=!!u&&!!r,_=j(r,`/email/verify/${u}/${r}`),{data:z,execute:y,status:g,error:c}=J(_,{immediate:m,lazy:!0});return{authState:z,verifyEmail:y,verificationStatus:g,verificationError:c,resendData:v,resending:d,resendError:x,resendVerificationEmail:async()=>{try{d.value=!0;const n=u?await f.resendEmail(u):null,s=n==null?void 0:n.message;s&&N({title:s}),v.value=n,d.value=!1}catch(n){N({title:"Error",description:"Failed to resend email",variant:"warning"}),d.value=!1,x.value=n}}}},Q={class:"h-full container pt-6"},X={key:0,class:"fixed inset-0 z-10 bg-background grid place-items-center"},Y={key:0,class:"relative grid place-items-center gap-2"},Z={key:1,class:"relative grid place-items-center gap-2 w-[700px] max-w-[100vw] mx-auto px-3"},ee={class:"text-2xl md:text-3xl font-semibold text-center"},te={class:"text-muted-foreground"},se={class:"text-foreground"},ae={class:"flex gap-4 mt-4"},ie={key:1},oe={key:2,class:"relative grid place-items-center gap-2 w-[700px] max-w-[100vw] mx-auto px-3"},ne={class:"text-2xl md:text-3xl font-semibold text-center mb-6"},le={class:"w-[700px] max-w-full mx-auto mt-8 space-y-6"},re={class:"text-muted-foreground text-center"},de={class:"text-foreground"},ce={class:"rounded-xl bg-white/5 p-4 md:p-6 w-[480px] max-w-full mx-auto flex flex-col md:flex-row gap-4 items-center justify-between z-10 relative"},ue={key:1},ve=M({__name:"email-confirmation",setup(u){const{authEmail:r,auth_user:f,saveAuthUser:x}=U(),v=B(()=>{var e;return((e=f.value)==null?void 0:e.role)==="host"?"/dashboard":"/audience"}),d=B(()=>{var s;return(s=f.value)==null?void 0:s.id}),m=q(),_=B(()=>{var s;return(s=m==null?void 0:m.query)==null?void 0:s.email_verify_url}),{verificationStatus:z,verificationError:y,resendVerificationEmail:g,resending:c,verifyEmail:A,authState:n}=P(d.value,_.value);return W(n,s=>{var h,b;const e=(h=s==null?void 0:s.data)==null?void 0:h.user,k=(b=s==null?void 0:s.data)==null?void 0:b.token;e&&k&&x(k,e)},{immediate:!0}),G({title:"Confirm your email"}),(s,e)=>{var D,F;const k=I,h=L,b=E;return i(),l("div",Q,[t(d)&&t(_)?(i(),l("div",X,[e[4]||(e[4]=a("div",{class:"bg-sp-purple/50 blur-[150px] size-56 absolute"},null,-1)),t(z)=="pending"?(i(),l("div",Y,[o(t(S),{class:"size-6 animate-spin"}),e[0]||(e[0]=a("div",{class:"text-base"},"Verifying email",-1))])):t(y)?(i(),l("div",Z,[o(t(O),{class:"size-10 text-destructive"}),a("div",ee,w(((F=(D=t(y))==null?void 0:D.data)==null?void 0:F.message)??"Email verification failed"),1),a("div",te,[e[1]||(e[1]=C(" Failed to verify ")),a("span",se,w(t(r)),1)]),a("div",ae,[o(E,{variant:"secondary",disabled:t(c),onClick:t(g)},{default:p(()=>[t(c)?(i(),T(t(S),{key:0,class:"size-5 animate-spin"})):(i(),l("span",ie,"Resend email"))]),_:1},8,["disabled","onClick"]),o(E,{onClick:t(A)},{default:p(()=>e[2]||(e[2]=[a("span",null,"Try again",-1)])),_:1},8,["onClick"])])])):(i(),l("div",oe,[o(t(K),{class:"size-10 text-primary"}),a("div",ne," Email ("+w(t(r))+") verified ",1),o(k,{to:t(v)},{default:p(()=>[o(E,null,{default:p(()=>e[3]||(e[3]=[C(" Done ")])),_:1})]),_:1},8,["to"])]))])):(i(),l(H,{key:1},[o(h,{to:"/login"}),e[9]||(e[9]=a("div",{class:"bg-sp-purple/50 blur-[200px] size-56 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},null,-1)),a("div",le,[e[8]||(e[8]=a("div",{class:"text-4xl md:text-5xl font-semibold text-center"}," Check your inbox to confirm your email address ",-1)),a("div",re,[e[5]||(e[5]=C(" We sent a mail to ")),a("span",de,w(t(r)),1),e[6]||(e[6]=C(" click the link to access your account "))]),a("div",ce,[e[7]||(e[7]=a("div",{class:"text-base"}," Didn't get the mail in your inbox or spam folder? ",-1)),o(b,{variant:"secondary",class:"w-full md:w-auto",disabled:t(c),onClick:t(g)},{default:p(()=>[t(c)?(i(),T(t(S),{key:0,class:"size-5 animate-spin"})):(i(),l("span",ue,"Resend"))]),_:1},8,["disabled","onClick"])])])],64))])}}});export{ve as default};
